#!/bin/sh

DISABLE_SET_PERMS=${DISABLE_SET_PERMS:-false}
UNBOUND_UID=${UNBOUND_UID:-1000}
UNBOUND_GID=${UNBOUND_GID:-1000}

bool=$DISABLE_SET_PERMS
if $bool; then
  exec /usr/local/unbound/sbin/unbound.sh
else
  set_perms=0
  if [ $(id -u _unbound) -ne $UNBOUND_UID ]; then
    usermod -o -u $UNBOUND_UID _unbound
    set_perms=1
  fi
  if [ $(id -g _unbound) -ne $UNBOUND_GID ]; then
    groupmod -o -g $UNBOUND_GID _unbound
    set_perms=1
  fi
  if [ $set_perms -eq 1 ]; then
    chown -R $UNBOUND_UID:$UNBOUND_GID /usr/local/unbound/ >/dev/null 2>&1
  fi
  exec su-exec $UNBOUND_UID:$UNBOUND_GID /usr/local/unbound/sbin/unbound.sh
fi
